@use "../../utils/variables";
@use "../../utils/mixins/palette";
@use "../../utils/mixins/selectors";
@use "../../utils/mixins/order";
@use "../../utils/mixins/media-query/media-query-width";
@use "sass:color";

// bubble
$bubbleBgColor: #fff;
$bubbleColor: #212121;
$bubbleBorder: #f1f1f1;
$bubbleIconBg: #2f75f7;
// buttons
$btnColor: palette.get-palette-hue("accent-1", 500);
$btnColorInactive: #92a6b4;
$btnColorActive: #fff;

#{variables.$classPrefix}__widget {
	$widget: &;

	&-wrapper {
		position: fixed;
		right: 1em;
		bottom: 1em;
		margin-left: 1em;
		z-index: order.get-order("widget");

		@at-root #{selector-unify(#{&}--advanced, #{selectors.bottom-most-fn(&)})} {
			display: flex;
			flex-direction: column;
			align-items: flex-end;
		}

		@at-root #{variables.$classPrefix}--left #{selectors.bottom-most-fn(&)} {
			right: auto;
			left: 1em;
			margin-left: 0;
			margin-right: 1em;
		}

		//@at-root #{variables.$classPrefix}--widget-round #{selectors.bottom-most-fn(&)} {
		//	bottom: 1em;
		//}

		@at-root #{variables.$classPrefix}--widget-tailed #{selectors.bottom-most-fn(&)} {
			bottom: 2em;
		}
	}

	&-bubble {
		padding: 0;
		color: $bubbleColor;
		// box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
		filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.12));

		@at-root {
			//#{selectors.parent-fn(&)} #{selectors.bottom-most-fn($widget)}-wrapper--simple #{selectors.bottom-most-fn(&)} {
			//	padding: 0.5em 1em;
			//}
			#{selectors.parent-fn(&)} #{selectors.bottom-most-fn($widget)}-wrapper--advanced #{selectors.bottom-most-fn(&)} {
				position: relative;
				margin-left: auto;
				// padding: 0.8em 1.5em;

				//&:hover, &:focus {
				//	background-color: palette.get-palette-hue("accent-1", 500);
				//	border-color: palette.get-palette-hue("accent-1", 500);
				//	color: #fff;
				//}

				//&#{variables.$classPrefix}__widget--minimalized {
				//	padding: 0.8em 1em;
				//}
			}

			//#{selectors.parent-fn(&)} #{selectors.bottom-most-fn($widget)}-wrapper--simple #{selectors.bottom-most-fn(&)} {
			//	background-color: color.scale($bubbleIconBg, $lightness: 5%);
			//}
		}

		// Bubble arrow
		@at-root {
			#{selectors.parent-fn(&)}:not(#{variables.$classPrefix}--widget-round) #{selectors.bottom-most-fn($widget)}-wrapper--simple #{selectors.bottom-most-fn(&)},
			#{variables.$classPrefix}--widget-tailed #{selectors.bottom-most-fn(&)} {
				&::after {
					content: "";
					position: absolute;
					right: 0.5em;
					bottom: calc(-1em + 3px);
					display: block;
					border: solid 0.5em $bubbleBgColor;
					border-bottom-color: transparent;
					border-left-color: transparent;
					transition: border-color cubic-bezier(0.1, 1, 0.6, 1) 0.3s;
				}

				&:hover, &:focus {
					&::after {
						border-top-color: palette.get-palette-hue("accent-1", 500); // color.scale($bubbleBgColor, $lightness: 5%);
						border-right-color: palette.get-palette-hue("accent-1", 500); // color.scale($bubbleBgColor, $lightness: 5%);
					}
				}
			}
		}

		&:hover {
			cursor: pointer;
		}

		//@at-root {
		//	#{variables.$classPrefix}--widget-round #{variables.$classPrefix}__widget-bubble {
		//		padding: 1em;
		//		border-radius: 50%;
		//	}
		//}
	}

	&-img {
		$img: &;

		display: block;
		flex: 0 0 auto;
		padding: 1em;
		// border: solid 1px $bubbleBorder;
		border-radius: 50%;
		background-color: $bubbleIconBg;
		color: $bubbleColor;
		transition: background-color cubic-bezier(0.1, 1, 0.6, 1) 0.3s, color cubic-bezier(0.1, 1, 0.6, 1) 0.3s, border-color cubic-bezier(0.1, 1, 0.6, 1) 0.3s, transform cubic-bezier(0.1, 1, 0.6, 1) 0.3s;

		& > img,
		& > svg {
			display: block;
			width: 2em;
			height: 2em;
		}

		@at-root {
			&#{selectors.bottom-most-fn(&)}--big {
				& > img,
				& > svg {
					display: block;
					width: 2.5em;
					height: 2.5em;
				}
			}

			#{selectors.parent-fn(&)}__widget-bubble {
				&:hover,
				&:focus-visible {
					#{selectors.bottom-most-fn($img)} {
						background-color: color.scale($bubbleIconBg, $lightness: 10%);
						transform: scale(1.1);
					}
				}

				#{selectors.bottom-most-fn($widget)}-wrapper--advanced {
					#{selectors.bottom-most-fn($img)} {
						position: relative;
						//padding: 12px;
						//border-radius: 50%;
						//background-color: $bubbleIconBg;

						// online status
						&::before {
							content: "";
							position: absolute;
							right: -3px;
							top: -3px;
							width: 17px;
							height: 17px;
							border: 2px solid #fff;
							border-radius: 50%;
							background-color: #bbb;
						}
					}

					#{variables.$classPrefix}__widget--online #{selectors.bottom-most-fn($img)} {
						&::before {
							background-color: #35d03d;
						}
					}
				}
			}
		}
	}

	// Start style: Simple

	&-greeting {
		margin-left: 1em;
	}

	// End style: Simple

	// Start style: Advanced

	&-greeting-wrapper {
		display: flex;
		align-items: center;

		@at-root {
			#{selectors.parent-fn(&)} #{selector-unify(#{selectors.bottom-most-fn($widget)}-wrapper--advanced, #{variables.$classPrefix}__widget--minimalized)} #{selectors.bottom-most-fn(&)} {
				justify-content: center;
			}
		}
	}

	&-greeting-msg-wrapper {
		display: flex;
		flex-direction: column;
		align-items: flex-end;
		position: relative;
		margin-top: 0.8em;
	}

	&-greeting-title {
		flex: 1 0 0;
		margin-left: 1em;
		font-size: 1.2em;
		font-weight: 500;
		word-break: break-word;
	}

	&-greeting-msg {
		width: max-content;
		max-width: 15em;
		padding: 1em 1.5em;
		border-radius: 14px 14px 0;
		background-color: #fefefe;
		line-height: 1.4;
		transition: color cubic-bezier(0.1, 1, 0.6, 1) 0.3s;

		@at-root {
			#{selectors.parent-fn(&)} #{selectors.bottom-most-fn($widget)}-bubble:hover #{selectors.bottom-most-fn(&)} {
				color: #e2e6f7;
			}
		}
	}

	&-name {
		margin-top: 0.5em;
		font-size: 0.9em;
		color: #727c9a;
		transition: color cubic-bezier(0.1, 1, 0.6, 1) 0.3s;

		@at-root {
			//#{selectors.parent-fn(&)} #{selectors.bottom-most-fn($widget)}-bubble:hover #{selectors.bottom-most-fn(&)} {
			//	color: #e2e6f7;
			//}

			#{selectors.parent-fn(&)} #{selector-unify(#{selectors.bottom-most-fn($widget)}-bubble, #{selectors.bottom-most-fn($widget)}--minimalized)} #{selectors.bottom-most-fn(&)} {
				text-align: center;
			}
		}
	}

	// End style: Advanced

	&-hide-btn {
		$hideBtn: &;

		position: absolute;
		top: 0;
		right: 0;
		padding: 0.5em;
		transform: translate(50%, -50%);

		&:hover {
			cursor: pointer;
		}

		//@at-root {
		//	#{variables.$classPrefix}--widget-round,
		//	#{selectors.parent-fn(&)} #{selectors.bottom-most-fn($widget)}--minimalized {
		//		#{selectors.bottom-most-fn($hideBtn)} {
		//			top: 0.5em;
		//			right: 0.5em;
		//		}
		//	}
		//}

		&-content {
			$hideBtnContent: &;

			display: block;
			width: 2em;
			height: 2em;
			padding: 0.5em;
			// border: solid 1px $bubbleBorder;
			border-radius: 50%;
			background: #fff;
			transition: background-color cubic-bezier(0.1, 1, 0.6, 1) 0.3s;

			& > img,
			& > svg {
				display: block;
				width: 100%;
				height: 100%;
			}

			& > svg {
				stroke: $btnColorInactive;
				transition: stroke cubic-bezier(0.1, 1, 0.6, 1) 0.3s;
			}

			@at-root #{$hideBtn} {
				&:hover,
				&:focus-visible {
					#{selectors.bottom-most-fn($hideBtnContent)} {
						background-color: #f44336;

						& > svg {
							stroke: $btnColorActive;
						}
					}
				}
			}

			@include media-query-width.m-small-devices {
				width: 2em;
				height: 2em;
				padding: 0.6em;
			}
		}
	}

	&-notification {
		position: absolute;
		top: 0.5em;
		left: 0.5em;
		transform: translate(-50%, -50%);
		width: 1.5em;
		display: flex;
		justify-content: center;
		align-items: center;
		height: 1.5em;
		padding: 0.3em;
		border: solid 1px $btnColor;
		border-radius: 50%;
		background-color: $btnColor;
		line-height: 1;
		color: #fff;

		//@at-root {
		//	#{variables.$classPrefix}--widget-round #{selectors.bottom-most-fn(&)} {
		//		left: -0.3em;
		//		top: -0.3em;
		//	}
		//}
	}
}
