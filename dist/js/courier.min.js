/*!
 * Courier.js v0.0.1
 * (c) 2020-2020 Adam KociÄ‡ (Falkan3)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Courier=e()}(this,function(){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function e(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=c(n);return u(this,r?(t=c(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function l(t,e,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}var f={breakpoints:{},ids:{dummyRoot:"courierDummyRoot"},classes:{root:"courier",widget:"courier__widget",chat:"courier__chat"},modifierClasses:{},texts:{},textVars:{}};function d(t){return"string"==typeof t}function h(t){var e=n(t);return"function"===e||"object"===e&&t}function p(t){return"function"==typeof t}function m(t){return t.constructor===Array}function v(e,n,t){var r=2<arguments.length&&void 0!==t?t:window;Object.keys(e).forEach(function(t){Object.hasOwnProperty.call(e,t)&&n.call(r,e[t],t,e)})}function y(t,e){var i=a({},t,e);return Object.hasOwnProperty.call(e,"ids")&&(i.ids=a({},t.ids,e.ids)),Object.hasOwnProperty.call(e,"classes")&&(i.classes=a({},t.classes,e.classes)),Object.hasOwnProperty.call(e,"breakpoints")&&(i.breakpoints=a({},t.breakpoints,e.breakpoints)),Object.hasOwnProperty.call(e,"texts")&&(i.texts=a({},t.texts,e.texts)),Object.hasOwnProperty.call(e,"textVars")&&(i.textVars=a({},t.textVars,e.textVars)),v(i.texts,function(t,e){var n,r,o;i.texts[e]=(n=t,r=i.textVars,o=n,v(r,function(t,e){var n=new RegExp("{{".concat(e,"}}"));o=o.replace(n,t)}),o)}),i}function g(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}var b,w=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.events=t,this.hop=t.hasOwnProperty}return i(e,[{key:"on",value:function(t,e){if(m(t))for(var n=0;n<t.length;n++)this.on(t[n],e);this.hop.call(this.events,t)||(this.events[t]=[]);var r=this.events[t].push(e)-1;return{remove:function(){delete this.events[t][r]}}}},{key:"emit",value:function(t,e){if(m(t))for(var n=0;n<t.length;n++)this.emit(t[n],e);this.hop.call(this.events,t)&&this.events[t].forEach(function(t){t(e||{})})}}]),e}(),O=function(){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};r(this,n),this._transformers=[],this._eventsBus=new w,this.disabled=!1,this.settings=y(f,e),this.rootElement=t||document.body}return i(n,[{key:"mount",value:function(t){var e,n,r,o,i=0<arguments.length&&void 0!==t?t:{};return this._eventsBus.emit("mount.before"),h(i)&&(this._components=(n=i,r=(e=this)._eventsBus,o={},Object.keys(n).forEach(function(t){p(n[t])&&(o[t]=n[t](e,o,r))}),Object.keys(o).forEach(function(t){Object.prototype.hasOwnProperty.call(o,t)&&p(o[t].mount)&&o[t].mount()}),o)),this._eventsBus.emit("mount.after"),this}},{key:"mutate",value:function(t){var e=0<arguments.length&&void 0!==t?t:[];return m(e)&&(this._transformers=e),this}},{key:"update",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};return this.settings=y(this.settings,e),this._eventsBus.emit("update"),this}},{key:"destroy",value:function(){return this._eventsBus.emit("destroy"),this}},{key:"disable",value:function(){return this.disabled=!0,this}},{key:"enable",value:function(){return this.disabled=!1,this}},{key:"on",value:function(t,e){return this._eventsBus.on(t,e),this}},{key:"settings",get:function(){return this._settings},set:function(t){h(t)&&(this._settings=t)}},{key:"disabled",get:function(){return this._disabled},set:function(t){this._disabled=!!t}}]),n}(),k=["checked","selected","value"],t={},x=!1;t.trueTypeOf=g;function E(t){if(x)throw new Error(t)}t.err=E;function j(t,e){var n=g(t);if("object"===n){var r={};for(var o in t)t.hasOwnProperty(o)&&(r[o]=j(t[o],e));return r}if("array"===n)return t.map(function(t){return j(t,e)});if("string"!==n||e)return t;var i=document.createElement("div");return i.textContent=t,i.innerHTML}function C(t){t.debounce&&window.cancelAnimationFrame(t.debounce),t.debounce=window.requestAnimationFrame(function(){t.render()})}function _(r){return{get:function(t,e){return-1<["object","array"].indexOf(g(t[e]))?new Proxy(t[e],_(r)):t[e]},set:function(t,e,n){return t[e]===n||(t[e]=n,C(r)),!0}}}function N(t,e){var n=t.filter(e);return n.length<1?null:n[0]}function P(t,e){if(!(t||e&&e.lagoon))return E("You did not provide an element to make into a component.");if(!e||!e.template&&!e.lagoon)return E("You did not provide a template for this component.");var n,r,o=this,i=(r=o,(n=e).setters?n.store?null:n.data:n.data&&!n.store?new Proxy(n.data,_(r)):null),a=e.store,c=e.router,s=e.setters,u=e.getters;o.debounce=null,Object.defineProperties(o,{elem:{value:t},template:{value:e.template},allowHTML:{value:e.allowHTML},lagoon:{value:e.lagoon},store:{value:a},attached:{value:[]},router:{value:c}}),Object.defineProperty(o,"data",{get:function(){return s?j(i,!0):i},set:function(t){return a||s||(i=new Proxy(t,_(o)),C(o)),!0}}),s&&!a&&Object.defineProperty(o,"do",{value:function(t){if(!s[t])return E("There is no setter with this name.");var e=Array.prototype.slice.call(arguments);e[0]=i,s[t].apply(o,e),C(o)}}),u&&!a&&Object.defineProperty(o,"get",{value:function(t){return u[t]?u[t](i):E("There is no getter with this name.")}}),c&&"addComponent"in c&&c.addComponent(o),a&&"attach"in a&&a.attach(o),e.attachTo&&("array"===g(e.attachTo)?e.attachTo:[e.attachTo]).forEach(function(t){"attach"in t&&t.attach(o)})}P.Store=function(t){return t.lagoon=!0,new P(null,t)};function A(e,t){t.forEach(function(t){e.style[t]=""})}function T(n,t){var e,r=t.split(";").reduce(function(t,e){var n=e.indexOf(":");return n&&t.push({name:e.slice(0,n).trim(),value:e.slice(n+1).trim()}),t},[]),o=Array.prototype.filter.call(n.style,function(e){return null===N(r,function(t){return t.name===e&&t.value===n.style[e]})});A(n,o),e=n,r.forEach(function(t){e.style[t.name]=t.value})}function S(e,t){t.forEach(function(t){if("class"===t.att)e.className=t.value;else if("style"===t.att)T(e,t.value);else{if(t.att in e)try{e[t.att]=t.value,e[t.att]||0===e[t.att]||(e[t.att]=!0)}catch(t){}try{e.setAttribute(t.att,t.value)}catch(t){}}})}function M(e,t){t.forEach(function(t){if("class"===t.att)e.className="";else if("style"===t.att)A(e,Array.prototype.slice.call(e.style));else{if(t.att in e)try{e[t.att]=""}catch(t){}try{e.removeAttribute(t.att)}catch(t){}}})}function L(t,e){return{att:t,value:e}}function R(t,e){if(1!==t.nodeType)return[];var n,r,o,i,a,c=(n=t,r=e,Array.prototype.reduce.call(n.attributes,function(t,e){return!(k.indexOf(e.name)<0||r&&"selected"===e.name)||7<e.name.length&&"default"===e.name.slice(0,7)||t.push(L(e.name,e.value)),t},[]));return o=t,i=c,a=e,k.forEach(function(t){!o[t]&&0!==o[t]||a&&"option"===o.tagName.toLowerCase()&&"selected"===t||a&&"select"===o.tagName.toLowerCase()&&"value"===t||i.push(L(t,o[t]))}),c}function B(t){return 3===t.nodeType?"text":8===t.nodeType?"comment":t.tagName.toLowerCase()}function D(t){return t.childNodes&&0<t.childNodes.length?null:t.textContent}function z(t,l,f){var d=Array.prototype.slice.call(l.childNodes),e=Array.prototype.slice.call(t.childNodes),n=d.length-e.length;if(0<n)for(;0<n;n--)d[d.length-n].parentNode.removeChild(d[d.length-n]);e.forEach(function(r,t){if(!d[t])return function e(n){1===n.nodeType&&(Array.prototype.forEach.call(n.attributes,function(t){t.name.length<8||"default"!==t.name.slice(0,7)||(S(n,[L(t.name.slice(7).toLowerCase(),t.value)]),M(n,[L(t.name,t.value)]))}),n.childNodes&&Array.prototype.forEach.call(n.childNodes,function(t){e(t)}))}(r),void l.appendChild(r.cloneNode(!0));var e,n,o,i,a,c;if(B(r)===B(d[t])){if(e=r,n=d[t],o=R(e,!0),i=R(n),a=i.filter(function(e){return!(-1<k.indexOf(e.att))&&null===N(o,function(t){return e.att===t.att})}),c=o.filter(function(e){var t=N(i,function(t){return e.att===t.att});return null===t||t.value!==e.value}),S(n,c),M(n,a),!(0<f.filter(function(t){return 3!==r.nodeType&&(e=r,n=t,Element.prototype.matches&&e.matches(n)||Element.prototype.msMatchesSelector&&e.msMatchesSelector(n)||Element.prototype.webkitMatchesSelector&&e.webkitMatchesSelector(n));var e,n}).length)){var s=D(r);if(s&&s!==D(d[t])&&(d[t].textContent=s),0<d[t].childNodes.length&&r.childNodes.length<1)d[t].innerHTML="";else{if(d[t].childNodes.length<1&&0<r.childNodes.length){var u=document.createDocumentFragment();return z(r,u,f),void d[t].appendChild(u)}0<r.childNodes.length&&z(r,d[t],f)}}}else d[t].parentNode.replaceChild(r.cloneNode(!0),d[t])})}function F(t,e){t&&t.forEach(function(t){return-1<t.attached.indexOf(e)?E("".concat(e.elem," has attached nodes that it is also attached to, creating an infinite loop.")):void("render"in t&&t.render())})}P.emit=function(t,e,n){var r;if(!t||!e)return E("You did not provide an element or event name.");r=new CustomEvent(e,{bubbles:!0,detail:n}),t.dispatchEvent(r)},P.prototype.render=function(){if(this.lagoon)F(this.attached,this);else{if(!this.template)return E("No template was provided.");var t="string"===g(this.elem)?document.querySelector(this.elem):this.elem;if(!t)return E("The DOM element to render your template into was not found.");var e=j((this.store?this.store.data:this.data)||{},this.allowHTML),n="function"===g(this.template)?this.template(e,this.router?this.router.current:null):this.template;if(!(["string","number"].indexOf(g(n))<0)){var r=this.attached.map(function(t){return t.elem});return z(function(t){if(b){var e=(new DOMParser).parseFromString(t,"text/html");return"head"in e&&"childNodes"in e.head&&0<e.head.childNodes.length&&Array.prototype.slice.call(e.head.childNodes).reverse().forEach(function(t){e.body.insertBefore(t,e.body.firstChild)}),e.body}var n=document.createElement("div");return n.innerHTML=t,n}(n),t,r),P.emit(t,"render",e),F(this.attached,this),t}}},P.prototype.attach=function(t){"array"===g(t)?this.attached.concat(t):this.attached.push(t)},P.prototype.detach=function(t){var e="array"===g(t)?t:[t],n=this;e.forEach(function(t){var e=n.attached.indexOf(t);e<0||n.attached.splice(e,1)})},P.debug=function(t){x=!!t},P.clone=j,P._=t,b=function(){if(!window.DOMParser)return!1;var t=new DOMParser;try{t.parseFromString("x","text/html")}catch(t){return!1}return!0}();var H=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.listeners=t}return i(e,[{key:"on",value:function(t,e,n,r){var o=3<arguments.length&&void 0!==r&&r;d(t)&&(t=[t]);for(var i=0;i<t.length;i++)this.listeners[t[i]]=n,e.addEventListener(t[i],this.listeners[t[i]],o)}},{key:"off",value:function(t,e,n){var r=2<arguments.length&&void 0!==n&&n;d(t)&&(t=[t]);for(var o=0;o<t.length;o++)e.removeEventListener(t[o],this.listeners[t[o]],r)}},{key:"destroy",value:function(){delete this.listeners}}]),e}();var V={App:function(t,n,e){var r=new H,o={refs:{},mount:function(){e.emit("app.mount.before"),this.initialize(),this.bind(),e.emit("app.mount.after")},bind:function(){var e=this;r.on("click",n.App.refs.app.elem,function(t){return e.click(t)})},unbind:function(){r.off("click",n.App.refs.app.elem)},click:function(t){return t},initialize:function(){o.refs.app=new P(t.rootElement,{data:{},template:function(){return'\n                <div id="courierRoot" class="'.concat(t.settings.classes.root,'">\n                    <div id="courierChat" class="').concat(t.settings.classes.chat,'"></div>\n                    <div id="courierWidget" class="').concat(t.settings.classes.widget,'"></div>\n                </div>')}})},render:function(){o.refs.app.render()}};return e.on("mount.after",function(){o.render(),e.emit("app.rendered")}),e.on(["destroy","update"],function(){o.unbind()}),e.on("update",function(){o.mount()}),e.on(["destroy"],function(){r.destroy()}),e.on(["destroy","app.mount.before"],function(){o.refs={}}),o},Chat:function(e,t,n){var r=new H,o={refs:{},mount:function(){n.emit("chat.mount.before"),this.initialize(),n.emit("chat.mount.after")},bind:function(){var e=this;r.on("click",t.App.refs.app.elem,function(t){return e.click(t)}),r.on("submit",t.App.refs.app.elem,function(t){return e.submit(t)})},unbind:function(){r.off("click",t.App.refs.app.elem)},click:function(t){return t},submit:function(t){return t.target.matches("#courierChatInteractionsForm")||document.querySelector("#courierChatInteractionsForm").contains(t.target),t},close:function(){this.refs.chat.data.active=!1,n.emit("chat.close")},open:function(){this.refs.chat.data.active=!0,n.emit("chat.open")},initialize:function(){o.refs.chat=new P("#courierChat",{data:{active:!1,text:{sendMessage:"Send message"}},template:function(t){return t.active?'\n                    <div class="'.concat(e.settings.classes.chat,'-wall">\n                        <div class="').concat(e.settings.classes.chat,'-work-area"></div>\n                        <form id="courierChatInteractionsForm" class="').concat(e.settings.classes.chat,'-interactions">\n                            <input type="text" class="').concat(e.settings.classes.chat,'-message-box" />\n                            <button class="').concat(e.settings.classes.chat,'-send-msg-btn" type="button" aria-label="').concat(t.sendMessage,'">\n                                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="512" viewBox="0 0 24 24" width="512"><path d="m14.077 16.79c-.065-.224-.231-.404-.448-.489l-3.857-1.5c-.231-.09-.491-.061-.695.08-.205.14-.327.371-.327.619v6.75c0 .324.208.611.516.713.077.025.156.037.234.037.234 0 .46-.11.604-.306l3.857-5.25c.139-.188.181-.429.116-.654z" fill="#2196f3"/><path d="m23.685.139c-.23-.163-.532-.185-.782-.054l-22.5 11.75c-.266.139-.423.423-.401.722.023.3.222.556.505.653l19.75 6.75c.079.026.161.04.243.04.136 0 .271-.037.39-.109.19-.116.319-.311.352-.53l2.75-18.5c.041-.28-.077-.558-.307-.722z" fill="#64b5f6"/></svg>\n                            </button>\n                        </form>\n                    </div>\n                    '):""},attachTo:t.App.refs.app})},render:function(){o.refs.chat.render()}};return n.on("app.rendered",function(){o.bind()}),n.on(["destroy","update"],function(){o.unbind()}),n.on("update",function(){o.mount()}),n.on(["destroy"],function(){r.destroy()}),n.on(["destroy","chat.mount.before"],function(){v(o.refs,function(t){t.el.parentNode&&t.el.parentNode.removeChild(t.el)}),o.refs={}}),o},Widget:function(e,n,t){var r=new H,o={refs:{},mount:function(){t.emit("widget.mount.before"),this.initialize(),t.emit("widget.mount.after")},bind:function(){var e=this;r.on("click",n.App.refs.app.elem,function(t){return e.click(t)})},unbind:function(){r.off("click",n.App.refs.app.elem)},click:function(t){return(t.target.matches("#courierWidgetButton")||document.querySelector("#courierWidgetButton").contains(t.target))&&n.Chat.open(),t},close:function(){this.refs.widget.data.active=!1,t.emit("widget.close")},open:function(){this.refs.widget.data.active=!0,t.emit("widget.open")},initialize:function(){o.refs.widget=new P("#courierWidget",{data:{active:!0,text:"Hello!"},template:function(t){return t.active?'\n                    <button id="courierWidgetButton" class="'.concat(e.settings.classes.widget,"-bubble ").concat(e.settings.classes.root,'__appear-bottom" type="button" aria-label="Open widget">\n                        <div class="').concat(e.settings.classes.widget,'-img" aria-hidden="true">\n                            <img src="https://image.flaticon.com/icons/svg/209/209999.svg" alt="Chat bubbles" />\n                        </div>\n                        <p>').concat(t.text,"</p>\n                    </button>"):""},attachTo:n.App.refs.app})},render:function(){o.refs.widget.render()}};return t.on("app.rendered",function(){o.bind()}),t.on("chat.open",function(){o.close()}),t.on("chat.close",function(){o.open()}),t.on(["destroy","update"],function(){o.unbind()}),t.on("update",function(){o.mount()}),t.on(["destroy"],function(){r.destroy()}),t.on(["destroy","widget.mount.before"],function(){v(o.refs,function(t){t.el.parentNode&&t.el.parentNode.removeChild(t.el)}),o.refs={}}),o}};return function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(n,O);var t=e(n);function n(){return r(this,n),t.apply(this,arguments)}return i(n,[{key:"mount",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};return l(c(n.prototype),"mount",this).call(this,a({},V,e))}}]),n}()});
